<?xml version="1.0" encoding="utf-8" ?>
<TrustFrameworkPolicy 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
  xmlns="http://schemas.microsoft.com/online/cpim/schemas/2013/06" 
  PolicySchemaVersion="0.3.0.0" 
  TenantId="{{environmentName}}authncs.onmicrosoft.com" 
  PolicyId="B2C_1A_TrustFrameworkExtensions_Invitation" 
  PublicPolicyUri="http://{{environmentName}}authncs.onmicrosoft.com/B2C_1A_TrustFrameworkExtensions_Invitation">
  
  <BasePolicy>
    <TenantId>{{environmentName}}authncs.onmicrosoft.com</TenantId>
    <PolicyId>B2C_1A_TrustFrameworkBase_Invitation</PolicyId>
  </BasePolicy>
  <BuildingBlocks>

    <ClaimsSchema>
        <ClaimType Id="newUserEmail">
          <DisplayName>Verified Email Address</DisplayName>
          <DataType>string</DataType>
          <UserInputType>TextBox</UserInputType>
        </ClaimType>

        <ClaimType Id="newUserObjectId">
          <DisplayName>Verified Email Address</DisplayName>
          <DataType>string</DataType>
          <UserInputType>Readonly</UserInputType>
        </ClaimType>

        <ClaimType Id="ReadOnlyEmail">
          <DisplayName>Verified Email Address</DisplayName>
          <DataType>string</DataType>
          <UserInputType>Readonly</UserInputType>
        </ClaimType>
      
        <ClaimType Id="errorMessage">
          <DataType>string</DataType>
          <UserInputType>Paragraph</UserInputType>
        </ClaimType> 

        <ClaimType Id="tncCheckbox">
          <DisplayName>Terms and conditions</DisplayName>
          <DataType>boolean</DataType>
          <UserHelpText>You must accept our Terms and Conditions</UserHelpText>
          <UserInputType>CheckboxMultiSelect</UserInputType>
          <Restriction>
            <Enumeration Text="I accept the terms and conditions and I am 13 or over" Value="true" SelectByDefault="false" />
          </Restriction>
        </ClaimType>
        
        <ClaimType Id="successMessage">
          <DataType>string</DataType>
          <UserHelpText>Add help text here</UserHelpText>
          <UserInputType>Paragraph</UserInputType>
        </ClaimType>

        <ClaimType Id="confirmationMessage">
          <DataType>string</DataType>
          <UserInputType>Paragraph</UserInputType>
        </ClaimType> 

        <ClaimType Id="emailIsNotEqual">
          <DisplayName>Email Is Not Equal</DisplayName>
          <DataType>boolean</DataType>
        </ClaimType>

        <ClaimType Id="expiry">
          <DisplayName>Expiry of email link</DisplayName>
          <DataType>dateTime</DataType>
        </ClaimType>

        <ClaimType Id="isAided">
          <DisplayName>Is aided registration</DisplayName>
          <DataType>boolean</DataType>
        </ClaimType>

        <ClaimType Id="currentTime">
          <DisplayName>Expiry of email link</DisplayName>
          <DataType>dateTime</DataType>
        </ClaimType>

        <ClaimType Id="isLinkValid">
          <DisplayName>Email link valid</DisplayName>
          <DataType>boolean</DataType>
        </ClaimType>

        <ClaimType Id="dobLabel">
          <DisplayName>Date of birth</DisplayName>
          <DataType>string</DataType>
          <UserHelpText>For example, 31 3 1980</UserHelpText>
          <UserInputType>Paragraph</UserInputType>
        </ClaimType>

        <ClaimType Id="day">
          <DisplayName>Day</DisplayName>
          <DataType>int</DataType>
          <UserInputType>TextBox</UserInputType>
        </ClaimType>

        <ClaimType Id="month">
          <DisplayName>Month</DisplayName>
          <DataType>int</DataType>
          <UserInputType>TextBox</UserInputType>
        </ClaimType>

        <ClaimType Id="year">
          <DisplayName>Year</DisplayName>
          <DataType>int</DataType>
          <UserInputType>TextBox</UserInputType>
        </ClaimType>

        <ClaimType Id="postCode">
          <DisplayName>Enter your postcode</DisplayName>
          <DataType>string</DataType>
          <UserHelpText>For example, SW1A 1AA</UserHelpText>
          <UserInputType>TextBox</UserInputType>
        </ClaimType>

        <ClaimType Id="foundEmail">
          <DataType>string</DataType>
        </ClaimType>

        <ClaimType Id="isFound">
          <DataType>boolean</DataType>
        </ClaimType>

        <ClaimType Id="foundEmailMessageWithEmail">
          <DataType>string</DataType>
          <UserInputType>Paragraph</UserInputType>
        </ClaimType>

        <ClaimType Id="foundEmailMessagelast">
          <DataType>string</DataType>
          <UserInputType>Paragraph</UserInputType>
        </ClaimType>

        <ClaimType Id="retryCounter">
          <DataType>int</DataType>
        </ClaimType>

        <ClaimType Id="isResend">
          <DataType>boolean</DataType>
        </ClaimType>

        <ClaimType Id="newEmailIsNotEqual">
          <DisplayName>Email Is Not Equal</DisplayName>
          <DataType>boolean</DataType>
        </ClaimType>

        <ClaimType Id="id_token_hint">
          <DataType>string</DataType>
          <UserInputType>Paragraph</UserInputType>
        </ClaimType>

        <ClaimType Id="journey">
          <DisplayName>journey</DisplayName>
          <DataType>string</DataType>
          <UserHelpText>which journey requested this token</UserHelpText>
        </ClaimType>

        <ClaimType Id="bearerToken">
          <DisplayName>Bearer token</DisplayName>
          <DataType>string</DataType>
        </ClaimType>

        <ClaimType Id="grant_type">
          <DisplayName>Grant type</DisplayName>
          <DataType>string</DataType>
        </ClaimType>

        <ClaimType Id="scope">
          <DisplayName>scope</DisplayName>
          <DataType>string</DataType>
        </ClaimType>

        <ClaimType Id="sendTokenBackRequired">
          <DataType>boolean</DataType>
        </ClaimType>

        <ClaimType Id="isTncUpdated">
          <DataType>boolean</DataType>
        </ClaimType>

        <ClaimType Id="lastModified">
          <DataType>dateTime</DataType>
        </ClaimType>

    </ClaimsSchema>

    <ClaimsTransformations>
      <ClaimsTransformation Id="SignupAccountActivatedConfirmationMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="You can start using your account to access your information." />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="confirmationMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreatePasswordResetConfirmationMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="We've changed your password" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="confirmationMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateSelfSignupDSSCustomerCreateErrorMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="Sorry, something happened unexpectedly. Please try again later" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="confirmationMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="IsEmailEqual" TransformationMethod="CompareClaims">
          <InputClaims>
              <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="inputClaim1" />
              <InputClaim ClaimTypeReferenceId="signInNames.emailAddress" TransformationClaimType="inputClaim2" />
          </InputClaims>
          <InputParameters>
              <InputParameter Id="operator" DataType="string" Value="NOT EQUAL" />
          </InputParameters>
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="emailIsNotEqual" TransformationClaimType="outputClaim" />
          </OutputClaims>
      </ClaimsTransformation>
      <ClaimsTransformation Id="CreateUnsolicitedErrorMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="You cannot sign-up without invitation" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="errorMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateLinkEpiredErrorMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="The link in your account activation email has expired" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="errorMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateSignupConfirmationLinkEpiredErrorMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="The link in your account activation email has expired" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="errorMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreatePasswordResetLinkEpiredErrorMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="The link in your password reset email has expired" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="errorMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateEmailSentMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="We have sent email to your email" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="successMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateSignupEmailSentMessage" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="We've sent an email to {0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="successMessage" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreatePasswordResetEmailSentMessage" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="We've sent an email to {0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="successMessage" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <!--Sample: Copy the email to ReadOnlyEamil claim type-->
      <ClaimsTransformation Id="CreateReadOnlyEmailAddress" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="{0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="ReadOnlyEmail" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CopyEmailAddress" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="ReadOnlyEmail" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="{0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="newUserEmail" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="GetCurrentDateTime" TransformationMethod="GetCurrentDateTime">
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="currentTime" TransformationClaimType="currentDateTime" />
          </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="IsLinkExpired" TransformationMethod="DateTimeComparison">
          <InputClaims>                    
              <InputClaim ClaimTypeReferenceId="expiry" TransformationClaimType="firstDateTime" />     
              <InputClaim ClaimTypeReferenceId="currentTime" TransformationClaimType="secondDateTime" />                                                       
          </InputClaims>
          <InputParameters>
              <InputParameter Id="operator" DataType="string" Value="later than" />
          </InputParameters>
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="isLinkValid" TransformationClaimType="result" />
          </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateEmailFoundMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="We've found your email address" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="successMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateEmailNotFoundMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="We have not been able to find your account" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="errorMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateFoundEmailMessageWithEmail" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="foundEmail" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="The email address registered to your account is: {0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="foundEmailMessageWithEmail" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateFoundEmailMessagelast" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="You'll need to use this email address to sign in to your account." />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="foundEmailMessagelast" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateEmailChangeLinkEpiredErrorMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="The activation link has expired" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="errorMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>


      <ClaimsTransformation Id="CreateChangeEmailEmailNotMatchedErrorMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="Sorry, can't proceed with provided information" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="errorMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateEmailChangeConfirmationMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="You can start using your account to access your information." />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="confirmationMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateEmailChangeEmailResentMessage" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="newEmail" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="We've sent an email to {0}." />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="confirmationMessage" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="IsNewEmailEqual" TransformationMethod="CompareClaims">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="newEmail" TransformationClaimType="inputClaim1" />
          <InputClaim ClaimTypeReferenceId="signInNames.emailAddress" TransformationClaimType="inputClaim2" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="operator" DataType="string" Value="NOT EQUAL" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="newEmailIsNotEqual" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateResentEmailEmailSentMessage" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="We've sent an email to {0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="successMessage" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>


      <ClaimsTransformation Id="IsResendEmailEqual" TransformationMethod="CompareClaims">
          <InputClaims>
              <InputClaim ClaimTypeReferenceId="email" TransformationClaimType="inputClaim1" />
              <InputClaim ClaimTypeReferenceId="resend_email" TransformationClaimType="inputClaim2" />
          </InputClaims>
          <InputParameters>
              <InputParameter Id="operator" DataType="string" Value="NOT EQUAL" />
          </InputParameters>
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="emailIsNotEqual" TransformationClaimType="outputClaim" />
          </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateSignupDisabledErrorMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value=" " />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="errorMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="AssertResendEmailVerified" TransformationMethod="AssertBooleanClaimIsEqualToValue">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="extension_IsEmailVerified" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="valueToCompareTo" DataType="boolean" Value="false" />
        </InputParameters>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateAidedRegResentEmailEmailSentMessage" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="resend_email" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="We've sent an email to {0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="successMessage" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateSigninEmailChangeActivationRequiredMessage" TransformationMethod="CreateStringClaim">
        <InputParameters>
          <InputParameter Id="value" DataType="string" Value="Our records show that you have recently updated information about your account." />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="confirmationMessage" TransformationClaimType="createdClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="createNewEmail" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="extension_NewEmail" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="{0}" />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="newEmail" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CreateSignInEmailChangeEmailResentMessage" TransformationMethod="FormatStringClaim">
        <InputClaims>
          <InputClaim ClaimTypeReferenceId="extension_NewEmail" TransformationClaimType="inputClaim" />
        </InputClaims>
        <InputParameters>
          <InputParameter Id="stringFormat" DataType="string" Value="We've sent an email to {0}." />
        </InputParameters>
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="confirmationMessage" TransformationClaimType="outputClaim" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="GetCurrentDateAndTime" TransformationMethod="GetCurrentDateTime">
        <OutputClaims>
          <OutputClaim ClaimTypeReferenceId="extension_TnCAcceptedOn" TransformationClaimType="currentDateTime" />
        </OutputClaims>
      </ClaimsTransformation>

      <ClaimsTransformation Id="CheckTncUpdated" TransformationMethod="DateTimeComparison">
        <InputClaims>                    
            <InputClaim ClaimTypeReferenceId="lastModified" TransformationClaimType="firstDateTime" />
            <InputClaim ClaimTypeReferenceId="extension_TnCAcceptedOn" TransformationClaimType="secondDateTime" />
        </InputClaims>
        <InputParameters>
            <InputParameter Id="operator" DataType="string" Value="later than" />
        </InputParameters>
        <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="isTncUpdated" TransformationClaimType="result" />
        </OutputClaims>
      </ClaimsTransformation>

    </ClaimsTransformations>

  </BuildingBlocks>

  <ClaimsProviders>

    <ClaimsProvider>
      <DisplayName>Local Account SignIn</DisplayName>
      <TechnicalProfiles>
        <TechnicalProfile Id="login-NonInteractive">
          <Metadata>
            <Item Key="client_id">{{proxyIdentAppRegistrationClientId}}</Item>
            <Item Key="IdTokenAudience">{{identAppRegistrationClientId}}</Item>
          </Metadata>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="client_id" DefaultValue="{{proxyIdentAppRegistrationClientId}}" />
            <InputClaim ClaimTypeReferenceId="resource_id" PartnerClaimType="resource" DefaultValue="{{identAppRegistrationClientId}}" />
          </InputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="LocalAccountSignUpWithEmail">
          <DisplayName>Email signup</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <Metadata>
            <Item Key="IpAddressClaimReferenceId">IpAddress</Item>
            <Item Key="ContentDefinitionReferenceId">api.localaccountsignup</Item>
            <Item Key="language.button_continue">Create an account</Item>
            <Item Key="setting.showCancelButton">false</Item>
            <!-- Sample: Remove sign-up email verification -->
            <Item Key="EnforceEmailVerification">False</Item>
          </Metadata>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="objectId" />
            <OutputClaim ClaimTypeReferenceId="givenName" Required="true" />
            <OutputClaim ClaimTypeReferenceId="surName" Required="true" />
            <OutputClaim ClaimTypeReferenceId="email" Required="true" />
            <OutputClaim ClaimTypeReferenceId="newPassword" Required="true" />
            <OutputClaim ClaimTypeReferenceId="reenterPassword" Required="true" />
            <OutputClaim ClaimTypeReferenceId="tncCheckbox" Required="true" />
            <OutputClaim ClaimTypeReferenceId="executed-SelfAsserted-Input" DefaultValue="true" />
            <OutputClaim ClaimTypeReferenceId="authenticationSource" />
            <OutputClaim ClaimTypeReferenceId="newUser" />
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="AAD-UserWriteUsingLogonEmail" />
            <ValidationTechnicalProfile ReferenceId="API-Send-Signup-Confirmation-Email" />
          </ValidationTechnicalProfiles>
          <!-- Sample: Disable session management for sign-up page -->
          <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
        </TechnicalProfile>

        <TechnicalProfile Id="AAD-Aided-UserWriteUsingLogonEmail">
          <Metadata>
            <Item Key="Operation">Write</Item>
            <Item Key="RaiseErrorIfClaimsPrincipalAlreadyExists">true</Item>
          </Metadata>
          <IncludeInSso>false</IncludeInSso>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateDisplayName" />
            <InputClaimsTransformation ReferenceId="GetCurrentDateAndTime" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="signInNames.emailAddress" Required="true" />
          </InputClaims>
          <PersistedClaims>
            <!-- Required claims -->
            <PersistedClaim ClaimTypeReferenceId="email" PartnerClaimType="signInNames.emailAddress" />
            <PersistedClaim ClaimTypeReferenceId="newPassword" PartnerClaimType="password"/>
            <PersistedClaim ClaimTypeReferenceId="displayName" />
            <PersistedClaim ClaimTypeReferenceId="passwordPolicies" DefaultValue="DisablePasswordExpiration" />
  
            <!-- Optional claims. -->
            <PersistedClaim ClaimTypeReferenceId="givenName" />
            <PersistedClaim ClaimTypeReferenceId="surname" />
            <PersistedClaim ClaimTypeReferenceId="extension_IsEmailVerified" DefaultValue="true" AlwaysUseDefaultValue="true" />
            <PersistedClaim ClaimTypeReferenceId="extension_IsEmailChangeRequested" DefaultValue="false" AlwaysUseDefaultValue="true" />
            <PersistedClaim ClaimTypeReferenceId="extension_NewEmail" DefaultValue="none" AlwaysUseDefaultValue="true" />
            <PersistedClaim ClaimTypeReferenceId="extension_TnCAcceptedOn" />
          </PersistedClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="objectId" />
            <OutputClaim ClaimTypeReferenceId="newUser" PartnerClaimType="newClaimsPrincipalCreated" />
            <OutputClaim ClaimTypeReferenceId="authenticationSource" DefaultValue="localAccountAuthentication" />
            <OutputClaim ClaimTypeReferenceId="userPrincipalName" />
            <OutputClaim ClaimTypeReferenceId="signInNames.emailAddress" />
            <OutputClaim ClaimTypeReferenceId="extension_IsEmailVerified" />
          </OutputClaims>
          <IncludeTechnicalProfile ReferenceId="AAD-Common" />
          <UseTechnicalProfileForSessionManagement ReferenceId="SM-AAD" />
        </TechnicalProfile>

        <TechnicalProfile Id="AidedRegistration">
          <DisplayName>Email signup</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <Metadata>
            <Item Key="IpAddressClaimReferenceId">IpAddress</Item>
            <Item Key="ContentDefinitionReferenceId">api.localaccountaidedsignup</Item>
            <Item Key="language.button_continue">Activate Account</Item>
            <Item Key="EnforceEmailVerification">False</Item>
            <Item Key="setting.retryLimit">5</Item>
          </Metadata>
          <InputClaimsTransformations>
            <!--Sample: Copy the email to ReadOnlyEamil claim type-->  
            <InputClaimsTransformation ReferenceId="CreateReadOnlyEmailAddress" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="email" />
            <InputClaim ClaimTypeReferenceId="givenName" />
            <InputClaim ClaimTypeReferenceId="surname" />
            <InputClaim ClaimTypeReferenceId="customerId" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="objectId" />
            <OutputClaim ClaimTypeReferenceId="newPassword" Required="true" />
            <OutputClaim ClaimTypeReferenceId="reenterPassword" Required="true" />
            <OutputClaim ClaimTypeReferenceId="dobLabel" />
            <OutputClaim ClaimTypeReferenceId="day" Required="true" />
            <OutputClaim ClaimTypeReferenceId="month" Required="true" />
            <OutputClaim ClaimTypeReferenceId="year" Required="true" />
            <OutputClaim ClaimTypeReferenceId="tncCheckbox" Required="true" />

            <OutputClaim ClaimTypeReferenceId="retryCounter" DefaultValue="0" />
            <OutputClaim ClaimTypeReferenceId="isFound" DefaultValue="false" />
            <OutputClaim ClaimTypeReferenceId="executed-SelfAsserted-Input" DefaultValue="true" />
            <OutputClaim ClaimTypeReferenceId="authenticationSource" DefaultValue="localAccountAuthentication"/>
            <OutputClaim ClaimTypeReferenceId="newUser" DefaultValue="true" />
            <OutputClaim ClaimTypeReferenceId="isAided" DefaultValue="true" />
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="API-AidedSignup-Validate-UserInfo" />
            <ValidationTechnicalProfile ReferenceId="AAD-Aided-UserWriteUsingLogonEmail" />
            <ValidationTechnicalProfile ReferenceId="API-AidedSignup-Create-DSSCustomer" />
            <ValidationTechnicalProfile ReferenceId="AAD-UserWriteCustomerUsingObjectId" />
          </ValidationTechnicalProfiles>
          <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
        </TechnicalProfile>

        <TechnicalProfile Id="LocalAccountDiscoveryUsingEmailAddress">
          <DisplayName>Reset password using email address</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <Metadata>
            <Item Key="IpAddressClaimReferenceId">IpAddress</Item>
            <Item Key="ContentDefinitionReferenceId">api.localaccountpasswordreset</Item>
            <Item Key="UserMessageIfClaimsTransformationBooleanValueIsNotEqual">Your account has been locked. Contact your support person to unlock it, then try again.</Item>
            <Item Key="language.button_continue">Send Email</Item>
          </Metadata>
          <CryptographicKeys>
            <Key Id="issuer_secret" StorageReferenceId="B2C_1A_TokenSigningKeyContainer" />
          </CryptographicKeys>
          <IncludeInSso>false</IncludeInSso>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="email" Required="true" />
            <OutputClaim ClaimTypeReferenceId="objectId" />
            <OutputClaim ClaimTypeReferenceId="userPrincipalName" />
            <OutputClaim ClaimTypeReferenceId="authenticationSource" />  
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="AAD-UserReadUsingEmailAddress" />
            <ValidationTechnicalProfile ReferenceId="API-Send-PasswordReset-Confirmation-Email">
              <Preconditions>
                <Precondition Type="ClaimsExist" ExecuteActionsIf="false">
                  <Value>objectId</Value>
                  <Action>SkipThisValidationTechnicalProfile</Action>
                </Precondition>
              </Preconditions>
            </ValidationTechnicalProfile>
          </ValidationTechnicalProfiles>
        </TechnicalProfile>


      </TechnicalProfiles>
    </ClaimsProvider>

    <ClaimsProvider>
      <DisplayName>My ID Token Hint ClaimsProvider</DisplayName>
      <TechnicalProfiles>
        <TechnicalProfile Id="IdTokenHint_ExtractClaims">
          <DisplayName> My ID Token Hint TechnicalProfile</DisplayName>
          <Protocol Name="None" />
          <CryptographicKeys>
            <Key Id="client_secret" StorageReferenceId="B2C_1A_ClientAssertionSigningKey" />
          </CryptographicKeys>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="email" />
            <OutputClaim ClaimTypeReferenceId="objectId" />
            <OutputClaim ClaimTypeReferenceId="surname" />
            <OutputClaim ClaimTypeReferenceId="givenName" />
            <OutputClaim ClaimTypeReferenceId="customerId" />
            <OutputClaim ClaimTypeReferenceId="expiry" />
            <OutputClaim ClaimTypeReferenceId="newEmail" />
            <OutputClaim ClaimTypeReferenceId="journey" />
          </OutputClaims>
        </TechnicalProfile>
      </TechnicalProfiles>
    </ClaimsProvider>

    <ClaimsProvider>
      <DisplayName>Self Asserted</DisplayName>
      <TechnicalProfiles>
        <TechnicalProfile Id="SelfAsserted-Unsolicited">
          <DisplayName>Unsolicited error message</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.selfasserted</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateUnsolicitedErrorMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="errorMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="errorMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-LinkExpired">
          <DisplayName>Unsolicited error message</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.aidedsignup.linkexpired</Item>
            <Item Key="language.button_continue">Resend activation email</Item>
            <Item Key="setting.showCancelButton">false</Item>
            <Item Key="setting.showContinueButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateLinkEpiredErrorMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="errorMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="errorMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-SignUpConfirmation-LinkExpired">
          <DisplayName>Unsolicited error message</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.selfsignup.linkexpired</Item>
            <Item Key="language.button_continue">Resend activation email</Item>
            <Item Key="setting.showCancelButton">false</Item>
            <Item Key="setting.showContinueButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateSignupConfirmationLinkEpiredErrorMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="errorMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="errorMessage"/>
          </OutputClaims>
        </TechnicalProfile>
        
        <TechnicalProfile Id="SelfAsserted-PasswordReset-LinkExpired">
          <DisplayName>PasswordReset-LinkExpired</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.passwordreset.linkexpired</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreatePasswordResetLinkEpiredErrorMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="errorMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="errorMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-Signup-EmailSentConfirmation">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.signup.emailsent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateSignupEmailSentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="email" />
            <InputClaim ClaimTypeReferenceId="successMessage" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="successMessage"/>
          </OutputClaims>
        </TechnicalProfile>
        
        <TechnicalProfile Id="SelfAsserted-PasswordReset-EmailSentConfirmation">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.passwordreset.emailsent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreatePasswordResetEmailSentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="email" />
            <InputClaim ClaimTypeReferenceId="successMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="successMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-ConfirmScreen">
          <DisplayName>Unsolicited error message</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.activated.account</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="SignupAccountActivatedConfirmationMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-PasswordReset-ConfirmScreen">
          <DisplayName>Unsolicited error message</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.passwordreset.passwordchanged</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreatePasswordResetConfirmationMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-SelfSignup-DSSCustomerCreationError">
          <DisplayName>Unsolicited error message</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.selfasserted</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateSelfSignupDSSCustomerCreateErrorMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </OutputClaims>
        </TechnicalProfile>


        <TechnicalProfile Id="SelfAsserted-ValidateEmail">
          <DisplayName>Validate Email Full Profile Edit</DisplayName>                    
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.ClaimsTransformationProtocolProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />                    
          <InputClaims>
              <InputClaim ClaimTypeReferenceId="email" />
              <InputClaim ClaimTypeReferenceId="signInNames.emailAddress" />
          </InputClaims> 
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="emailIsNotEqual" />
          </OutputClaims>
          <OutputClaimsTransformations>
              <OutputClaimsTransformation ReferenceId="IsEmailEqual" />
          </OutputClaimsTransformations>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-ValidateEmailLink">
          <DisplayName>Validate Email Full Profile Edit</DisplayName>                    
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.ClaimsTransformationProtocolProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />                    
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="GetCurrentDateTime" />
          </InputClaimsTransformations>
          <InputClaims>
              <InputClaim ClaimTypeReferenceId="expiry" />
              <InputClaim ClaimTypeReferenceId="currentTime" />
          </InputClaims> 
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="isLinkValid" />
          </OutputClaims>
          <OutputClaimsTransformations>
              <OutputClaimsTransformation ReferenceId="IsLinkExpired" />
          </OutputClaimsTransformations>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-CreateFoundEmailMessageWithEmail">
          <DisplayName>Create FoundEmail Message With Email</DisplayName>                    
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.ClaimsTransformationProtocolProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />                    
          <InputClaimsTransformations>
              <InputClaimsTransformation ReferenceId="CreateFoundEmailMessageWithEmail" />
          </InputClaimsTransformations>
          <InputClaims>
              <InputClaim ClaimTypeReferenceId="foundEmail" />
              <InputClaim ClaimTypeReferenceId="foundEmailMessageWithEmail" />
          </InputClaims> 
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="foundEmailMessageWithEmail" />
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-EmailFoundConfirmation">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.localaccountforgotemail.emailfound</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <!-- <InputClaimsTransformation ReferenceId="CreateEmailFoundMessage" /> -->
            <InputClaimsTransformation ReferenceId="CreateFoundEmailMessageWithEmail" />
            <InputClaimsTransformation ReferenceId="CreateFoundEmailMessagelast" />
          </InputClaimsTransformations>
          <InputClaims>
            <!-- <InputClaim ClaimTypeReferenceId="successMessage" /> -->
            <InputClaim ClaimTypeReferenceId="foundEmailMessageWithEmail" />
            <InputClaim ClaimTypeReferenceId="foundEmailMessagelast" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="successMessage"/>
            <OutputClaim ClaimTypeReferenceId="foundEmailMessageWithEmail" />
            <OutputClaim ClaimTypeReferenceId="foundEmailMessagelast" />
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-EmailNotFoundConfirmation">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.localaccountforgotemail.emailnotfound</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateEmailNotFoundMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="errorMessage" />           
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="errorMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-FindUserEmail">
          <DisplayName>Find User Email</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <Metadata>
            <Item Key="IpAddressClaimReferenceId">IpAddress</Item>
            <Item Key="ContentDefinitionReferenceId">api.localaccountforgotemail</Item>
            <Item Key="UserMessageIfClaimsTransformationBooleanValueIsNotEqual">Your account has been locked. Contact your support person to unlock it, then try again.</Item>
            <Item Key="language.button_continue">Find email address</Item>
          </Metadata>
          <CryptographicKeys>
            <Key Id="issuer_secret" StorageReferenceId="B2C_1A_TokenSigningKeyContainer" />
          </CryptographicKeys>
          <IncludeInSso>false</IncludeInSso>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="givenName" Required="true" />
            <OutputClaim ClaimTypeReferenceId="surname" Required="true" />
            <OutputClaim ClaimTypeReferenceId="dobLabel" />
            <OutputClaim ClaimTypeReferenceId="day" Required="true" />
            <OutputClaim ClaimTypeReferenceId="month" Required="true" />
            <OutputClaim ClaimTypeReferenceId="year" Required="true" />
            <OutputClaim ClaimTypeReferenceId="postCode" Required="true" />
            <OutputClaim ClaimTypeReferenceId="foundEmail" />
            <OutputClaim ClaimTypeReferenceId="isFound" />
            <OutputClaim ClaimTypeReferenceId="objectId" DefaultValue="123" />
            <OutputClaim ClaimTypeReferenceId="bearerToken" DefaultValue=""/>
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <!-- <ValidationTechnicalProfile ReferenceId="SecureREST-AccessToken" /> -->
            <ValidationTechnicalProfile ReferenceId="API-Find-User-Email" />
          </ValidationTechnicalProfiles>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-ChangeEmail-LinkExpired">
          <DisplayName>ChangeEmail-LinkExpired</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.changeemail.linkexpired</Item>
            <Item Key="language.button_continue">Request new activation link</Item>
            <Item Key="setting.showCancelButton">false</Item>
            <Item Key="setting.showContinueButton">true</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateEmailChangeLinkEpiredErrorMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="errorMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="errorMessage"/>
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="API-Send-ChangeEmail-Activation-Email" />
          </ValidationTechnicalProfiles>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-EmailChange-EmailNotMatched">
          <DisplayName>Unsolicited error message</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.selfasserted</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateChangeEmailEmailNotMatchedErrorMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="errorMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="errorMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-EmailChange-ConfirmScreen">
          <DisplayName>EmailChange ConfirmScreen</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.changeemail.emailactivated</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateEmailChangeConfirmationMessage" />
          </InputClaimsTransformations>         
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-ChangeEmail-ResentEmail">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.changeemail.emailresent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateEmailChangeEmailResentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="confirmationMessage"/>
            <InputClaim ClaimTypeReferenceId="newEmail"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-ValidateNewEmail">
          <DisplayName>Validate Email Full Profile Edit</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.ClaimsTransformationProtocolProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="newEmail" />
            <InputClaim ClaimTypeReferenceId="signInNames.emailAddress" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="newEmailIsNotEqual" />
          </OutputClaims>
          <OutputClaimsTransformations>
            <OutputClaimsTransformation ReferenceId="IsNewEmailEqual" />
          </OutputClaimsTransformations>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-AidedSignup-ResentEmail">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.aidedsignup.emailresent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateSignupEmailSentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="successMessage"/>
            <InputClaim ClaimTypeReferenceId="email"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="successMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-SelfSignup-ResentEmail">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.selfsignup.emailresent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateSignupEmailSentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="email" />
            <InputClaim ClaimTypeReferenceId="successMessage" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="successMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-Resent-Email-EmailSentConfirmation">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.resendemail.emailsent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateResentEmailEmailSentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="email" />
            <InputClaim ClaimTypeReferenceId="successMessage" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="successMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-AiidedReg-Resent-Email-EmailSentConfirmation">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.resendemail.aidedsignup.emailsent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateAidedRegResentEmailEmailSentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="resend_email" />
            <InputClaim ClaimTypeReferenceId="successMessage" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="successMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="ClaimsTransformation-Resend-AssertEmailVerified">
          <DisplayName>Assert Email Verified Claims Transformation</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.ClaimsTransformationProtocolProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="extension_IsEmailVerified" />
          </OutputClaims>
          <OutputClaimsTransformations>
            <OutputClaimsTransformation ReferenceId="AssertResendEmailVerified" />
          </OutputClaimsTransformations>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-Resend-ValidateEmail">
          <DisplayName>Validate Email Full Profile Edit</DisplayName>                    
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.ClaimsTransformationProtocolProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />                    
          <InputClaims>
              <InputClaim ClaimTypeReferenceId="email" />
              <InputClaim ClaimTypeReferenceId="resend_email" />
          </InputClaims> 
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="emailIsNotEqual" />
          </OutputClaims>
          <OutputClaimsTransformations>
              <OutputClaimsTransformation ReferenceId="IsResendEmailEqual" />
          </OutputClaimsTransformations>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-AidedReg-Resend-Email-Validator">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.resendemail.aidedsignup</Item>
            <Item Key="language.button_continue">Send activation email</Item>
            <Item Key="setting.showCancelButton">false</Item>
            <Item Key="UserMessageIfClaimsTransformationBooleanValueIsNotEqual">ACCOUNT_ACTIVATED</Item>
         </Metadata>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="resend_email"/>
            <OutputClaim ClaimTypeReferenceId="isFound"/>
            <OutputClaim ClaimTypeReferenceId="emailIsNotEqual" />
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="SelfAsserted-Resend-ValidateEmail" />
            <ValidationTechnicalProfile ReferenceId="AAD-Resend-UserReadUsingEmailAddress">
              <Preconditions>
                <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
                  <Value>emailIsNotEqual</Value>
                  <Value>True</Value>
                  <Action>SkipThisValidationTechnicalProfile</Action>
                </Precondition>
              </Preconditions>
            </ValidationTechnicalProfile>
            <ValidationTechnicalProfile ReferenceId="ClaimsTransformation-Resend-AssertEmailVerified">
              <Preconditions>
                <Precondition Type="ClaimsExist" ExecuteActionsIf="false">
                  <Value>userPrincipalName</Value>
                  <Action>SkipThisValidationTechnicalProfile</Action>
                </Precondition>
                <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
                  <Value>emailIsNotEqual</Value>
                  <Value>True</Value>
                  <Action>SkipThisValidationTechnicalProfile</Action>
                </Precondition>
              </Preconditions>
            </ValidationTechnicalProfile>
            <ValidationTechnicalProfile ReferenceId="API-Check-User-Existence">
              <Preconditions>
                <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
                  <Value>emailIsNotEqual</Value>
                  <Value>True</Value>
                  <Action>SkipThisValidationTechnicalProfile</Action>
                </Precondition>
              </Preconditions>
            </ValidationTechnicalProfile>
          </ValidationTechnicalProfiles>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-LocalAccountSignUpWithEmailDisabled">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.selfsignup.disabled</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateSignupDisabledErrorMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="errorMessage" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="errorMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-ChangeEmail-Resent-Email-EmailSentConfirmation">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.resendemail.changeemail.emailsent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateEmailChangeEmailResentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="confirmationMessage"/>
            <InputClaim ClaimTypeReferenceId="newEmail"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="confirmationMessage"/>
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-Email-Change-Activation-Required">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.signin.changeemail.activationrequired</Item>
            <Item Key="language.button_continue">Resend account activation link</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateSigninEmailChangeActivationRequiredMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="confirmationMessage"/>
            <InputClaim ClaimTypeReferenceId="objectId"/>
            <InputClaim ClaimTypeReferenceId="extension_NewEmail"/>
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="confirmationMessage"/>
            <OutputClaim ClaimTypeReferenceId="id_token_hint" DefaultValue=""/>
          </OutputClaims>
          <OutputClaimsTransformations>
            <OutputClaimsTransformation ReferenceId="createNewEmail" />
          </OutputClaimsTransformations>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="API-Send-SignIn-ChangeEmail-Activation-Email" />
          </ValidationTechnicalProfiles>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-Email-Change-Activation-Email-ResentConfirmation">
          <DisplayName>Email Sent</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"/>
          <Metadata>
            <Item Key="ContentDefinitionReferenceId">api.signin.changeemail.emailresent</Item>
            <Item Key="setting.showContinueButton">false</Item>
            <Item Key="setting.showCancelButton">false</Item>
         </Metadata>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="CreateSignInEmailChangeEmailResentMessage" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="confirmationMessage"/>
            <InputClaim ClaimTypeReferenceId="newEmail"/>
            <InputClaim ClaimTypeReferenceId="id_token_hint" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="confirmationMessage"/>
            <OutputClaim ClaimTypeReferenceId="id_token_hint" />
          </OutputClaims>
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-TncDate-Validation">
          <DisplayName>Validate Terms and conditions accepted date</DisplayName>                    
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.ClaimsTransformationProtocolProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />                    
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="GetCurrentDateTime" />
          </InputClaimsTransformations>
          <InputClaims>
              <InputClaim ClaimTypeReferenceId="extension_TnCAcceptedOn" />
              <InputClaim ClaimTypeReferenceId="lastModified" />
          </InputClaims> 
          <OutputClaims>
              <OutputClaim ClaimTypeReferenceId="isTncUpdated" />
          </OutputClaims>
          <OutputClaimsTransformations>
              <OutputClaimsTransformation ReferenceId="CheckTncUpdated" />
          </OutputClaimsTransformations>
        </TechnicalProfile>

        <TechnicalProfile Id="AAD-TncAcceptedTimeWriteEmailUsingObjectId">
          <Metadata>
            <Item Key="Operation">Write</Item>
            <Item Key="RaiseErrorIfClaimsPrincipalAlreadyExists">false</Item>
            <Item Key="RaiseErrorIfClaimsPrincipalDoesNotExist">true</Item>
          </Metadata>
          <IncludeInSso>false</IncludeInSso>
          <InputClaimsTransformations>
            <InputClaimsTransformation ReferenceId="GetCurrentDateAndTime" />
          </InputClaimsTransformations>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="objectId" Required="true" />
          </InputClaims>
          <PersistedClaims>
            <PersistedClaim ClaimTypeReferenceId="objectId" />
            <PersistedClaim ClaimTypeReferenceId="extension_TnCAcceptedOn" />
          </PersistedClaims>
          <IncludeTechnicalProfile ReferenceId="AAD-Common" />
        </TechnicalProfile>

        <TechnicalProfile Id="SelfAsserted-AcceptLatestTnc">
          <DisplayName>Email signup</DisplayName>
          <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.SelfAssertedAttributeProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
          <Metadata>
            <Item Key="IpAddressClaimReferenceId">IpAddress</Item>
            <Item Key="ContentDefinitionReferenceId">api.termsandconditions</Item>
            <Item Key="language.button_continue">Continue to your account</Item>
            <Item Key="setting.showCancelButton">false</Item>
          </Metadata>
          <InputClaims>
            <InputClaim ClaimTypeReferenceId="objectId" Required="true" />
          </InputClaims>
          <OutputClaims>
            <OutputClaim ClaimTypeReferenceId="tncCheckbox" Required="true" />
          </OutputClaims>
          <ValidationTechnicalProfiles>
            <ValidationTechnicalProfile ReferenceId="AAD-TncAcceptedTimeWriteEmailUsingObjectId" />
          </ValidationTechnicalProfiles>
          <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
        </TechnicalProfile>

      </TechnicalProfiles>
    </ClaimsProvider>

    <ClaimsProvider>
        <DisplayName>API Claim Providers</DisplayName>
        <TechnicalProfiles>
            <TechnicalProfile Id="API-Send-Signup-Confirmation-Email">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                    <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/SignupConfirmation?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                    <Item Key="SendClaimsIn">Body</Item>                        
                    <Item Key="AuthenticationType">None</Item>
                    <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="givenName" />
                    <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="email" />
                    <InputClaim ClaimTypeReferenceId="ObjectId" PartnerClaimType="ObjectId"/>
                </InputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Send-PasswordReset-Confirmation-Email">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                    <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/PasswordResetConfirmation?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                    <Item Key="SendClaimsIn">Body</Item>                        
                    <Item Key="AuthenticationType">None</Item>
                    <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="email" />
                    <InputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="givenName" />
                    <InputClaim ClaimTypeReferenceId="ObjectId" PartnerClaimType="ObjectId"/>
                </InputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Find-User-Email">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/FindEmail?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <!-- <InputClaim ClaimTypeReferenceId="bearerToken"/> -->
                    <InputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="GivenName" />
                    <InputClaim ClaimTypeReferenceId="surname" PartnerClaimType="SurName"/>
                    <InputClaim ClaimTypeReferenceId="day" PartnerClaimType="Day"/>
                    <InputClaim ClaimTypeReferenceId="month" PartnerClaimType="Month"/>
                    <InputClaim ClaimTypeReferenceId="year" PartnerClaimType="Year"/>
                    <InputClaim ClaimTypeReferenceId="postCode" PartnerClaimType="PostalCode"/>
                </InputClaims>
                <OutputClaims>
                  <OutputClaim ClaimTypeReferenceId="foundEmail" />
                  <OutputClaim ClaimTypeReferenceId="isFound" />
                </OutputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-AidedSignup-Validate-UserInfo">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/AidedRegistrationValidateUserDetails?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="customerId" PartnerClaimType="CustomerId" />
                    <InputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="GivenName" />
                    <InputClaim ClaimTypeReferenceId="surname" PartnerClaimType="SurName"/>
                    <InputClaim ClaimTypeReferenceId="day" PartnerClaimType="Day"/>
                    <InputClaim ClaimTypeReferenceId="month" PartnerClaimType="Month"/>
                    <InputClaim ClaimTypeReferenceId="year" PartnerClaimType="Year"/>
                    <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="Email"/>
                    <InputClaim ClaimTypeReferenceId="retryCounter" PartnerClaimType="RetryCounter"/>
                </InputClaims>
                <OutputClaims>
                  <OutputClaim ClaimTypeReferenceId="isFound" />
                </OutputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-AidedSignup-Create-DSSCustomer">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/NCSDSSUserCreation?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="objectId" PartnerClaimType="ObjectId"/>
                    <InputClaim ClaimTypeReferenceId="customerId" PartnerClaimType="CustomerId"/>
                    <InputClaim ClaimTypeReferenceId="isAided" DefaultValue="true" PartnerClaimType="IsAided"/>
                </InputClaims>
                <OutputClaims>
                  <OutputClaim ClaimTypeReferenceId="customerId" />
                </OutputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-SelfSignup-Create-DSSCustomer">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/NCSDSSUserCreation?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="objectId" PartnerClaimType="ObjectId"/>
                    <InputClaim ClaimTypeReferenceId="customerId" PartnerClaimType="CustomerId"/>
                    <InputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="givenName"/>
                    <InputClaim ClaimTypeReferenceId="surname" PartnerClaimType="Surname"/>
                    <InputClaim ClaimTypeReferenceId="signInNames.emailAddress" PartnerClaimType="Email"/>
                    <InputClaim ClaimTypeReferenceId="isAided" DefaultValue="false" PartnerClaimType="IsAided"/>
                </InputClaims>
                <OutputClaims>
                  <OutputClaim ClaimTypeReferenceId="customerId" />
                </OutputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Send-ChangeEmail-Activation-Email">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/ChangeEmail?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="objectId" PartnerClaimType="ObjectId"/>
                    <InputClaim ClaimTypeReferenceId="newEmail" PartnerClaimType="NewEmail"/>
                    <InputClaim ClaimTypeReferenceId="isResend" DefaultValue="true" PartnerClaimType="IsResend"/>
                </InputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Send-AidedSignup-Resent-Email">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/SignUpInvitation?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="Email"/>
                    <InputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="GivenName"/>
                    <InputClaim ClaimTypeReferenceId="surname" PartnerClaimType="LastName"/>
                    <InputClaim ClaimTypeReferenceId="customerId" PartnerClaimType="CustomerId"/>
                    <InputClaim ClaimTypeReferenceId="isResend" DefaultValue="true" PartnerClaimType="IsResend"/>
                </InputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Send-SelfSignup-Resent-Email">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/SignupConfirmation?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="email"/>
                    <InputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="givenName"/>
                    <InputClaim ClaimTypeReferenceId="objectId" PartnerClaimType="ObjectId"/>
                    <InputClaim ClaimTypeReferenceId="isResend" DefaultValue="true" PartnerClaimType="IsResend"/>
                </InputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Send-PasswordReset-Resent-Email">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                    <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/PasswordResetConfirmation?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                    <Item Key="SendClaimsIn">Body</Item>                        
                   <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="email" PartnerClaimType="email" />
                    <InputClaim ClaimTypeReferenceId="givenName" PartnerClaimType="givenName" />
                    <InputClaim ClaimTypeReferenceId="objectId" PartnerClaimType="ObjectId"/>
                </InputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Check-User-Existence">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/CheckDSSUSerExistence?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="resend_email" PartnerClaimType="email" />
                </InputClaims>
                <OutputClaims>
                  <OutputClaim ClaimTypeReferenceId="isFound" />
                </OutputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Send-SignIn-ChangeEmail-Activation-Email">
                <DisplayName>User OTP Notifications</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/ChangeEmail?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Body</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <InputClaims>
                    <InputClaim ClaimTypeReferenceId="sendTokenBackRequired" PartnerClaimType="SendTokenBackRequired" DefaultValue="true" />
                    <InputClaim ClaimTypeReferenceId="objectId" PartnerClaimType="ObjectId"/>
                    <InputClaim ClaimTypeReferenceId="extension_NewEmail" PartnerClaimType="NewEmail"/>
                    <InputClaim ClaimTypeReferenceId="isResend" DefaultValue="true" PartnerClaimType="IsResend"/>
                </InputClaims>
                <OutputClaims>
                  <OutputClaim ClaimTypeReferenceId="id_token_hint" />
                </OutputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

            <TechnicalProfile Id="API-Get-Tnc-Update-Details">
                <DisplayName>Tnc Details</DisplayName>    
                <Protocol Name="Proprietary" Handler="Web.TPEngine.Providers.RestfulProvider, Web.TPEngine, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
                <Metadata>
                  <Item Key="ServiceUrl">https://{{eapimRootUrl}}/{{apimAppName}}/GetTncDetails?subscription-key={{dfeEapimSubscriptionKey}}</Item>
                  <Item Key="SendClaimsIn">Header</Item>                        
                  <Item Key="AuthenticationType">None</Item>
                  <Item Key="AllowInsecureAuthInProduction">true</Item>
                </Metadata>
                <OutputClaims>
                  <OutputClaim ClaimTypeReferenceId="lastModified" />
                </OutputClaims>
                <UseTechnicalProfileForSessionManagement ReferenceId="SM-Noop" />
            </TechnicalProfile>

        </TechnicalProfiles>
    </ClaimsProvider>

  </ClaimsProviders>


  <UserJourneys>
  
    <UserJourney Id="SelfSignUp">
      <OrchestrationSteps>
        <OrchestrationStep Order="1" Type="ClaimsExchange" ContentDefinitionReferenceId="api.selfsignup.disabled">
          <ClaimsExchanges>
            <ClaimsExchange Id="LocalAccountSignUpWithEmailDisabled" TechnicalProfileReferenceId="SelfAsserted-LocalAccountSignUpWithEmailDisabled"/>
          </ClaimsExchanges>
        </OrchestrationStep>
        <OrchestrationStep Order="2" Type="ClaimsExchange" ContentDefinitionReferenceId="api.localaccountsignup">
          <ClaimsExchanges>
            <ClaimsExchange Id="LocalAccountSignUpWithEmail" TechnicalProfileReferenceId="LocalAccountSignUpWithEmail"/>
          </ClaimsExchanges>
        </OrchestrationStep>
        <OrchestrationStep Order="3" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="LocalAccountSignUpEmailSentConfirmation" TechnicalProfileReferenceId="SelfAsserted-Signup-EmailSentConfirmation"/>
          </ClaimsExchanges>
        </OrchestrationStep>  
        <OrchestrationStep Order="4" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer"/>
      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb"/>
    </UserJourney>

    <UserJourney Id="SignIn">
      <OrchestrationSteps>
      
        <OrchestrationStep Order="1" Type="CombinedSignInAndSignUp" ContentDefinitionReferenceId="api.signuporsignin">
          <ClaimsProviderSelections>
           <ClaimsProviderSelection ValidationClaimsExchangeId="LocalAccountSigninEmailExchange"/>
          </ClaimsProviderSelections>
          <ClaimsExchanges>
            <ClaimsExchange Id="LocalAccountSigninEmailExchange" TechnicalProfileReferenceId="SelfAsserted-LocalAccountSignin-Email"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="2" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="AADUserReadWithObjectId" TechnicalProfileReferenceId="AAD-UserReadUsingObjectId"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="3" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="Get-Tnc-Update-Details" TechnicalProfileReferenceId="API-Get-Tnc-Update-Details"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="4" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="TncDate-Validation" TechnicalProfileReferenceId="SelfAsserted-TncDate-Validation"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="5" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>extension_TnCAcceptedOn</Value>
              <Value>undefined</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="AcceptUpdatedTnc-OldUser" TechnicalProfileReferenceId="SelfAsserted-AcceptLatestTnc"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="6" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isTncUpdated</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="AcceptUpdatedTnc" TechnicalProfileReferenceId="SelfAsserted-AcceptLatestTnc"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="7" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>extension_IsEmailChangeRequested</Value>
              <Value>False</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-Email-Change-Activation-Required" TechnicalProfileReferenceId="SelfAsserted-Email-Change-Activation-Required"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="8" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>extension_IsEmailChangeRequested</Value>
              <Value>False</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-Email-Change-Activation-Email-ResentConfirmation" TechnicalProfileReferenceId="SelfAsserted-Email-Change-Activation-Email-ResentConfirmation"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="9" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer"/>
 
      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb"/>
    </UserJourney>

    <UserJourney Id="SignUpConfirmation">
      <OrchestrationSteps>
        <OrchestrationStep Order="1" Type="GetClaims" CpimIssuerTechnicalProfileReferenceId="IdTokenHint_ExtractClaims" />

        <OrchestrationStep Order="2" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="CheckLinkValidity" TechnicalProfileReferenceId="SelfAsserted-ValidateEmailLink"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="3" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-SignUpConfirmation-LinkExpired" TechnicalProfileReferenceId="SelfAsserted-SignUpConfirmation-LinkExpired"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="4" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-SelfSignup-ResentEmail" TechnicalProfileReferenceId="SelfAsserted-SelfSignup-ResentEmail"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="5" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="AADUserReadWithObjectId" TechnicalProfileReferenceId="AAD-UserReadUsingObjectId"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="6" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="IsEmailEqual" TechnicalProfileReferenceId="SelfAsserted-ValidateEmail"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="7" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>emailIsNotEqual</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-Unsolicited" TechnicalProfileReferenceId="SelfAsserted-Unsolicited"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="8" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="Create-DSS-Customer" TechnicalProfileReferenceId="API-SelfSignup-Create-DSSCustomer"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="9" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimsExist" ExecuteActionsIf="true">
              <Value>customerId</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="DSSCustomerCreationError" TechnicalProfileReferenceId="SelfAsserted-SelfSignup-DSSCustomerCreationError"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="10" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
            <Precondition Type="ClaimsExist" ExecuteActionsIf="false">
              <Value>customerId</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="ActivateAccount" TechnicalProfileReferenceId="AAD-UserWriteEmailVerifiedUsingObjectId"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="11" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-ConfirmScreen" TechnicalProfileReferenceId="SelfAsserted-ConfirmScreen"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="12" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer"/>
      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb"/>
    </UserJourney>

    <UserJourney Id="SignupInvitation">
      <OrchestrationSteps>

        <OrchestrationStep Order="1" Type="GetClaims" CpimIssuerTechnicalProfileReferenceId="IdTokenHint_ExtractClaims" />

        <OrchestrationStep Order="2" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="CheckLinkValidity" TechnicalProfileReferenceId="SelfAsserted-ValidateEmailLink"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="3" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-LinkExpired" TechnicalProfileReferenceId="SelfAsserted-LinkExpired"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="4" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-AidedSignup-ResentEmail" TechnicalProfileReferenceId="SelfAsserted-AidedSignup-ResentEmail"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="5" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimsExist" ExecuteActionsIf="true">
              <Value>email</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-Unsolicited" TechnicalProfileReferenceId="SelfAsserted-Unsolicited"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="6" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="AidedRegistration" TechnicalProfileReferenceId="AidedRegistration"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="7" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>newUser</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-ConfirmScreen" TechnicalProfileReferenceId="SelfAsserted-ConfirmScreen"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="8" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer"/>

      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb"/>
    </UserJourney>

    <UserJourney Id="PasswordReset">
      <OrchestrationSteps>
        <OrchestrationStep Order="1" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="PasswordResetUsingEmailAddressExchange" TechnicalProfileReferenceId="LocalAccountDiscoveryUsingEmailAddress" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="2" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="LocalAccountPasswordResetEmailSentConfirmation" TechnicalProfileReferenceId="SelfAsserted-PasswordReset-EmailSentConfirmation"/>
          </ClaimsExchanges>
        </OrchestrationStep>
        
        <OrchestrationStep Order="3" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer" />
      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb" />
    </UserJourney>
    
    <UserJourney Id="PasswordResetConfirmation">
      <OrchestrationSteps>
        <OrchestrationStep Order="1" Type="GetClaims" CpimIssuerTechnicalProfileReferenceId="IdTokenHint_ExtractClaims" />

        <OrchestrationStep Order="2" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="CheckLinkValidity" TechnicalProfileReferenceId="SelfAsserted-ValidateEmailLink"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="3" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-PasswordReset-LinkExpired" TechnicalProfileReferenceId="SelfAsserted-PasswordReset-LinkExpired"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="4" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="AADUserReadWithObjectId" TechnicalProfileReferenceId="AAD-UserReadUsingObjectId"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="5" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="IsEmailEqual" TechnicalProfileReferenceId="SelfAsserted-ValidateEmail"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="6" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>emailIsNotEqual</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-Unsolicited" TechnicalProfileReferenceId="SelfAsserted-Unsolicited"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="7" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="NewCredentials" TechnicalProfileReferenceId="LocalAccountWritePasswordUsingObjectId" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="8" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="PasswordReset-ConfirmScreen" TechnicalProfileReferenceId="SelfAsserted-PasswordReset-ConfirmScreen"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="9" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer"/>
      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb"/>
    </UserJourney>

    <UserJourney Id="FindEmail">
      <OrchestrationSteps>

        <OrchestrationStep Order="1" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="FindEmailExchange" TechnicalProfileReferenceId="SelfAsserted-FindUserEmail"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="2" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isFound</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="EmailNotFound" TechnicalProfileReferenceId="SelfAsserted-EmailNotFoundConfirmation"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="3" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isFound</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions> 
          <ClaimsExchanges>
            <ClaimsExchange Id="EmailFound" TechnicalProfileReferenceId="SelfAsserted-EmailFoundConfirmation"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="4" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer"/>

      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb"/>
    </UserJourney>

    <UserJourney Id="ChangeEmail">
      <OrchestrationSteps>
        <OrchestrationStep Order="1" Type="GetClaims" CpimIssuerTechnicalProfileReferenceId="IdTokenHint_ExtractClaims" />

        <OrchestrationStep Order="2" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="CheckLinkValidity" TechnicalProfileReferenceId="SelfAsserted-ValidateEmailLink"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="3" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-ChangeEmail-LinkExpired" TechnicalProfileReferenceId="SelfAsserted-ChangeEmail-LinkExpired"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="4" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-ChangeEmail-ResentEmail" TechnicalProfileReferenceId="SelfAsserted-ChangeEmail-ResentEmail"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="5" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="AADUserReadWithObjectId" TechnicalProfileReferenceId="AAD-UserReadUsingObjectId"/>
          </ClaimsExchanges>
        </OrchestrationStep>


        <OrchestrationStep Order="6" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="IsNewEmailEqual" TechnicalProfileReferenceId="SelfAsserted-ValidateNewEmail" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="7" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>newEmailIsNotEqual</Value>
              <Value>False</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="EmailChange-AlreadyActivated-ConfirmScreen" TechnicalProfileReferenceId="SelfAsserted-EmailChange-ConfirmScreen" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="8" Type="ClaimsExchange">
          <ClaimsExchanges>
            <ClaimsExchange Id="IsEmailEqual" TechnicalProfileReferenceId="SelfAsserted-ValidateEmail"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="9" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>emailIsNotEqual</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="SelfAsserted-Unsolicited" TechnicalProfileReferenceId="SelfAsserted-EmailChange-EmailNotMatched"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="10" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>
          <ClaimsExchanges>
            <ClaimsExchange Id="AAD-ChangeEmail" TechnicalProfileReferenceId="AAD-UserWriteEmailUsingObjectId" />
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="11" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>isLinkValid</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="EmailChange-ConfirmScreen" TechnicalProfileReferenceId="SelfAsserted-EmailChange-ConfirmScreen"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="12" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer"/>
      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb"/>
    </UserJourney>

    <UserJourney Id="ResendEmail">
      <OrchestrationSteps>
        <OrchestrationStep Order="1" Type="GetClaims" CpimIssuerTechnicalProfileReferenceId="IdTokenHint_ExtractClaims" />

        <OrchestrationStep Order="2" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>journey</Value>
              <Value>changeemail</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="Send-ChangeEmail-Activation-Email" TechnicalProfileReferenceId="API-Send-ChangeEmail-Activation-Email"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="3" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>journey</Value>
              <Value>aidedsignup</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="AidedReg-Resend-Email-Validator" TechnicalProfileReferenceId="SelfAsserted-AidedReg-Resend-Email-Validator"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="4" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>journey</Value>
              <Value>passwordreset</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="Send-PasswordReset-Resent-Email" TechnicalProfileReferenceId="API-Send-PasswordReset-Resent-Email"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="5" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>journey</Value>
              <Value>selfsignup</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>        
          <ClaimsExchanges>
            <ClaimsExchange Id="Send-SelfSignup-Resent-Email" TechnicalProfileReferenceId="API-Send-SelfSignup-Resent-Email"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="6" Type="ClaimsExchange">
         <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>journey</Value>
              <Value>aidedsignup</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>isFound</Value>
              <Value>False</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="true">
              <Value>emailIsNotEqual</Value>
              <Value>True</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>       
          <ClaimsExchanges>
            <ClaimsExchange Id="Send-AidedSignup-Resent-Email" TechnicalProfileReferenceId="API-Send-AidedSignup-Resent-Email"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="7" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>journey</Value>
              <Value>changeemail</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>       
          <ClaimsExchanges>
            <ClaimsExchange Id="Resent-ChangeEmail-EmailSentConfirmation" TechnicalProfileReferenceId="SelfAsserted-ChangeEmail-Resent-Email-EmailSentConfirmation"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="8" Type="ClaimsExchange">
          <Preconditions>
            <Precondition Type="ClaimEquals" ExecuteActionsIf="false">
              <Value>journey</Value>
              <Value>aidedsignup</Value>
              <Action>SkipThisOrchestrationStep</Action>
            </Precondition>
          </Preconditions>      
          <ClaimsExchanges>
            <ClaimsExchange Id="Resent-Email-AidedReg-EmailSentConfirmation" TechnicalProfileReferenceId="SelfAsserted-AiidedReg-Resent-Email-EmailSentConfirmation"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="9" Type="ClaimsExchange">       
          <ClaimsExchanges>
            <ClaimsExchange Id="Resent-Email-EmailSentConfirmation" TechnicalProfileReferenceId="SelfAsserted-Resent-Email-EmailSentConfirmation"/>
          </ClaimsExchanges>
        </OrchestrationStep>

        <OrchestrationStep Order="10" Type="SendClaims" CpimIssuerTechnicalProfileReferenceId="JwtIssuer"/>

      </OrchestrationSteps>
      <ClientDefinition ReferenceId="DefaultWeb"/>
    </UserJourney>

  </UserJourneys>

</TrustFrameworkPolicy>